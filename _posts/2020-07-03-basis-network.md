---
layout: page
title: 计算机网络 面试
---

### 请描述三次握手？
为了确认双方通信正常，而执行的三次握手。

* 第一次：syn=1, seq=x，进入syn_send状态
* 第二次：syn=1, ack=1, seq=y, acknum=x+1，进入syn_rcvd状态
* 第三次：ack=1,acknum=y+1，都进入established状态

#### 为什么要传回SYN？
接受段告诉发送端我收到的信息就是发出的信号。

#### 为什么要带ACK？
证明从服务端到请求端通道完好。

#### 什么是半连接协议？
处于SYN_RCVD状态的连接，它会被放入一个队列。

#### SYN_ACK的重传次数？
未收到ACK，按指数时间间隔重传，如果超过最大数，就停止重传

#### 初始序列号是固定的吗？
不是，ISN随时间变化，每4m+1就动态生成

#### 三次握手可以携带数据吗？
只有第三次可以

#### SYN攻击是什么？
伪造客户端不断发包，占用半连接队列使请求被丢弃。

#### 有什么方法防止SYN攻击？
* SYN TIMEOUT off
* 增加半连接队列长度
* 过滤网关保护
* SYN cookie

### 请描述4次握手
* 第一次：fin=1，seq=x FIN_WAIT1-->CLOSEDWAIT
* 第二次：ack=1, acknum=x+1 FINWAIT2<--
* 第三次：fin=1, seq=y TIME_WAIT<--LAST_ACK
* 第四次：ack=1, acknum=y+1 -->CLOSED
* 后续：2MSL CLOSED

一旦收到一个FIN，表示这个通道上就没有数据流动了。

服务器端没有TIME_WAIT，通常只能被动关闭。

#### 为什么要回收四次？
因为服务器端可能还有数据没传完，传完才能发FIN。


#### 客户端为什么要等待2MSL？
* 为保证最后一个ACK到达服务器，不然服务器无法被动关闭
* 防止失效的请求报文出现在连接中

### TCP、UDP的比较？
| 协议  | 连接   | 是否可靠 | 原理  | 效率 | 占用  | 场景 | 首部      |
|-----|------|------|-----|----|-----|----|---------|
| TCP | 面向连接 | 可靠   | 字节流 | 慢  | 资源多 | 可靠 | 20-60字节 |
| UDP | 无连接  | 不可靠  | 报文段 | 快  | 资源少 | 快速 | 8字节     |

Socket是TCP/IP的抽象层

TCP有确认、窗口、重传、拥塞控制

* ECE：IP中ECN为1时置为1，表示有阻塞
* URG：紧急指针
* PSH：立即上传至上层协议
* RST：TCP异常，强制断开

### TCP长短连接的区别？
* 短：一次读写，一次close
* 长：请求端不主动关闭连接，会给server造成压力。有存货功能探测

### 为什么TCP有拆包粘包而UDP没有？
UDP 16bit报文指示长度，很容易区分

TCP 没有表示数据长度的字符

### 什么是拆包、粘包？
粘包：发两个数据包，收到时合成为一个

拆包：发两个数据包，收到时拆了一个

### 为什么会拆包、粘包？
* 发送的数据大于TCP发送缓冲区的剩余大小
* 带发送数据大于MSS最大报文长度
* 发送数据小于发送缓冲区大小，TCP多次写入数据一次发出，粘包
* 接受端没有及时读取接收缓冲区数据、粘包

### 如何应对拆包、粘包？
* 消息定长
* 设置消息边界，增加换行符分割
* 消息头和消息体中包含总长度

### TCP为什么是可靠的？
#### 什么是RTT
从发送到收到确认所经历的时间（往返时间）
$$RTO=RTT_s+4*RTT_d$$

#### 流量控制怎么样的？

控制发送速率，保证接收方来得及接收。发送端主机是不是发送一个窗口探测的数据段，仅包含一个字节来获得最新的窗口大小。

#### 拥塞控制是通过什么实现的？

能够降低整个网络的拥堵程度。

通过四个算法：慢开始、快重传、拥塞避免、快恢复

* 慢开始：$cwnd=1$，收到确认，2，4，8增长
* 拥塞避免：当$cwnd>=ssthresh$，$cwnd+=1$；如果超时或重复确认，ssthresh就变成cwnd/2，如果因为超时，就直接慢开始
* 快重传：3个重复确认，直接重传
* 快恢复：三个重复确认，$ssthresh=cwnd/2$，但不是慢开始，$cwnd=ssthresh$，然后加法增大。

### 有哪些提高网络利用率的方法？
* Nagle
* 延迟确认应答
* 捎带应答


### 浏览器访问经历的过程？
1. 域名DNS IP
2. 发送HTTP请求
3. TCP过程
4. 反向代理
5. 服务器
6. 缓存集群
7. 数据库
8. HTTP响应
9. 渲染HTML

### DNS的查询过程？
是一种递归查询。现在本地域名服务器中找，根到子域查询。

浏览器缓存、系统缓存、路由器缓存、IPS服务器缓存、根域名缓存、顶级域名服务器、主域名服务器缓存。

### HTTP长短链接？
* HTTP/1.0 短链接，每次都是一个会话
* HTTP/1.1 默认长连接，需要C/S都支持长连接

其实是TCP的长连接和短链接